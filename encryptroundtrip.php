<?php
	if ($_GET['showsource'])
	{
		show_source("encryptroundtrip.php");
		die();
	}
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd"
    >
<html lang="en">
<head>
    <title>Encrypt Round Trip</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div id="page">

		<p><a href="./index.html">Home</a>&nbsp;<a href="./encryptroundtrip.php?showsource=1">Show source</a></p>

	    <h1>Encrypt Round Trip</h1>
		<p>Perform encryption using a custom implementation of RSA.  Very non-secure, but academically interesting.  d=1031, e=1847, n=16717.</p>



<?php

// These 1024 numbers are % 4096
    $random = array(
 3101,  3809,  1778,  3860,   346,  1911,  1919,  1213,  1972,  1708,  2655,  1251,  3628,  2758,   715,  2992, 
 3795,  2532,   377,  3535,  1852,  2204,   182,  1067,  1329,   994,  1717,  1273,  2981,   555,   551,  3576, 
 1002,  4051,  1291,  1015,  3876,  2748,   456,  2969,  3070,   313,  3705,  3925,  1179,  2090,   648,  1728, 
 2256,  3176,   638,   783,  2192,   867,  3609,  1239,   679,  3849,  1184,  3864,  2987,  2282,   883,  2938, 
  304,  2202,   742,   982,  3388,  2391,  1359,  1272,  3579,   748,  3166,  3748,  1459,  2517,  2221,  1238, 
 1785,  2724,  1944,  1614,   294,  1188,   847,  3148,   261,  1979,  2345,  1945,  2510,  2453,  2620,  3782, 
 2648,  1534,  2602,   440,   650,  3728,    61,  1637,  3347,  3471,  3767,   728,   346,    17,  1123,  2171, 
  440,  2914,  3184,  1173,  2534,   422,   127,  2578,   433,  2496,   251,  2179,  2037,  3699,  1961,  1125, 
 2504,  2247,  2176,  1190,  2550,  2479,  1210,  2405,  3246,  1768,  1067,  4090,  2938,  3876,  2258,  2102, 
 1396,  2408,   174,  3819,  4024,   947,  2514,   431,  2581,  1248,  3260,  4062,  3080,  1485,   227,  3294, 
 3562,  1469,  3983,  1959,   616,  3579,  2285,  2946,  1076,  2241,  3939,  3600,  3066,  3927,  3361,  3727, 
  662,   895,  2041,  2649,   900,  2065,  1904,  2733,   919,  3299,   277,  4018,  4078,   491,  3857,  3257, 
 2341,  1448,  1280,  2499,  3784,   701,  1791,  3651,  3853,   224,  1798,  2341,  3778,  3314,  3193,  2574, 
 3460,  3183,  2553,  4070,  2610,     9,  1408,   148,  2977,  2448,  1709,  3592,   401,  2325,  3932,  3199, 
  480,  1359,   634,  3586,  1534,   830,  3352,  1840,  3233,   269,  1469,   318,   954,  2109,  1537,  3388, 
 3751,  2816,   599,  3226,  3242,   227,  1067,   746,   922,  1712,  2605,  1255,   728,  1427,   748,  2231, 
  645,  1403,  1446,  2925,   754,  3779,  3422,  4050,    88,  3858,  2608,  2661,  3786,  1408,  3298,  3744, 
  615,  2554,   187,   381,  2004,   999,  1944,  1337,   234,  1035,  3132,   600,  2475,  1452,  3816,   489, 
 2427,  2804,    43,  3339,  1165,  2199,  3580,  1456,   411,  1206,  1798,  3233,  2010,  3330,  2115,  2243, 
 2349,  2084,  2252,   920,  3224,  1629,  2032,  3848,  3320,  1385,   387,  2146,  4082,  2986,  3192,  3230, 
 2346,  3714,  1971,   485,  3509,  2049,  2328,  2643,  3024,  4032,   744,  1019,  2770,  2828,   845,  2603, 
 1887,  2119,   563,  3058,  4063,  2444,   346,  3040,  1326,   658,   681,  3341,   917,  3539,  2246,   348, 
 2042,  3309,  1507,  3329,  1363,  2120,  3291,   833,  3681,   505,  2173,   121,  1946,  4070,  3367,  1378, 
 1383,   299,  2200,  1939,  2703,   701,  1023,  2888,  2803,  1869,  3159,  2657,  1661,  1648,  1271,  3246, 
   83,  1788,  2149,  1385,  1616,  2229,  2924,  2564,  3252,   297,  1646,  1574,   538,  4056,  2299,   240, 
 4011,  3480,  2977,  1924,  2450,  2872,  1030,   200,   943,   868,  3893,  3687,  3728,   968,  1590,  3865, 
  157,   377,   225,  1573,  3986,  3216,  2803,  3108,  3635,  1816,  3938,  3335,   571,   810,  3566,  1883, 
 1685,  3158,  3833,   204,  3534,    69,  2456,  1000,  2251,  2717,  4074,  2854,  1463,  2085,  1449,  3367, 
 2880,  1322,  1278,  3643,  1027,  2849,  1434,  2855,  3652,   397,  2562,   294,   995,  1571,  1834,  1837, 
 3723,    44,  2630,  3187,  3117,   812,   221,    49,  1965,  1217,  1823,  1702,  2523,  2509,   120,  3935, 
 1700,  3799,  3685,   181,  2698,  4015,  2439,  3223,  3153,   593,   246,   650,  1787,  2316,   983,   749, 
 4087,  4068,  2353,  1922,  3478,  2356,  2556,  1322,   446,  3480,   379,  2800,  3298,   777,  1996,   585, 
 3377,  3914,  2750,  1178,  3598,  2436,  2274,  2555,  3009,  3885,   741,  1339,  3948,    45,  1820,   292, 
 1856,  1604,  2913,   768,  3824,  2982,  2334,  1628,  3174,  1257,  4007,  1547,  1206,   545,   205,  1646, 
 3408,  2890,  2992,  1267,  3449,  3046,  2516,   220,  1020,   486,   631,   322,  1308,   974,  2082,  3161, 
 1230,   533,  1151,  1013,   293,  1994,  1642,  2893,   270,  3710,  1610,  2559,  2877,  2397,  1186,    85, 
 2407,  2974,  1763,   199,  2994,  3614,  1669,   705,   106,  2119,  1621,   678,  1013,    55,   529,   788, 
 3337,  1566,  3122,   874,  2332,  3816,  3593,  3975,  3356,   541,  3597,  3285,  3681,  3845,   116,  2183, 
 2016,  3343,  1536,  2846,  4001,  2931,  3356,  1330,   115,  1047,  2343,  2415,  3038,  1456,  1040,  2014, 
 2137,  2345,  3619,  3685,  4029,  1608,    34,   658,   506,  2959,   920,  2196,     8,  3424,  1386,  2954, 
  801,   101,  1711,  2817,  1070,   815,  4033,   439,  1919,  2845,  2452,  2469,   190,  2176,   327,   317, 
  806,  1532,  2553,  1521,   496,  1842,   222,  2036,  1294,  2715,  1938,  2884,  1564,   695,  2221,  2536, 
 2452,  2664,  2711,  2934,  2113,  2200,  1182,  1497,  3318,  1826,  2629,  2897,  2687,   240,   223,  2491, 
 3544,  2913,   861,  3859,   157,  3821,  2149,  1847,  4034,   779,  3748,  1774,  2692,   338,   868,  2088, 
 3487,   991,  1889,  2952,  3778,   760,  1496,   799,  3136,  1518,   482,  2683,  1288,  2888,  3584,  4064, 
 3287,  3101,   503,   725,   172,  3778,   734,  3042,  3965,  3238,   373,   409,  2856,  3961,   696,  3795, 
 1452,  2452,  1716,  3644,  3737,  3477,   410,  3858,  1221,  2377,  2834,  1833,    65,  2000,  2001,  1587, 
 2187,  3835,   366,  3646,  2821,  3065,   113,  1406,  1446,   819,  3246,  1357,  2544,  1908,  2001,  2672, 
 3106,  3149,  1593,  2716,   686,  1976,  2570,   824,  2541,  1787,  1149,  1381,    18,  2767,   379,   828, 
 3421,  3778,   363,   598,  3217,  4058,  1352,  1938,  1959,  1659,   246,    18,  3268,  1930,  2006,  2951, 
 3945,   211,  1944,  2991,  2537,  1192,  1360,  3356,   801,  2251,   204,  3382,  3171,  3215,   549,   387, 
 2995,  2617,  1429,  1062,  1590,  1964,  2440,  2470,  3815,  2630,   758,  1009,  3468,   517,  3055,  1697, 
  489,  4078,   120,   125,  1843,  2991,  3477,  3651,  3015,  3203,  1703,  2725,   284,  2390,  1272,  3985, 
 2038,  1066,  1429,  3253,  3293,  1209,  2396,  1859,  2254,  1627,  2901,  1777,  2608,  3371,   326,  1093, 
 2569,  1637,  2689,  3087,   370,  2067,   257,  3127,   841,  1001,   181,  3512,  3621,   365,  2332,  4077, 
 2703,   859,  3346,  2316,  2415,  3143,  1258,  4080,  1732,  1668,  1724,   795,  1176,   837,  2304,   251, 
  564,  1282,   860,  1388,   912,  2333,   443,   127,  3341,  1222,  3487,  2681,  1894,  2332,   440,  2335, 
 4068,   660,  2997,  2609,  2258,  1951,    90,  1845,  3633,  2695,  1491,  1653,   685,   666,  2120,  3403, 
 2255,   139,  3249,  1948,  3187,   533,  1516,  2211,   125,  2273,    12,  2288,  1224,  2218,  1525,  1456, 
 2143,   159,  1318,  1326,  3056,  1033,   981,  1178,  2173,  1581,  3393,   778,  3669,  3444,  2116,  3518, 
   67,   457,  3111,   424,  3845,  2627,  1979,  1579,  2303,  3588,  3749,  1316,   561,  3169,   250,  1063, 
 2151,    67,   268,   779,  1967,   716,  2947,   936,   784,   318,  1455,  3807,  1401,  2585,  1564,  2779, 
 3832,  1412,  2919,  1687,   556,  3310,  1361,  3744,  1533,  1525,  1042,  3869,  3978,  1159,   496,  1804, 
 2147,  2119,  2831,   206,  1273,  2354,  1931,   998,  3923,  1922,  3012,  1022,  2562,   722,   761,   298);

    // I compute b^e mod m
    function  Compute($base, $exponent, $modulus)
    {
        $result = 1;
        while ($exponent > 0)
        {
            if ($exponent % 2 == 1)
            {
                $result = ($result * $base) % $modulus;
            }

            $exponent /= 2;
            $base = ($base * $base) % $modulus;
        }
        
        return $result;
    }


/*
	$count = 0;
	for ($i=0; $i<16717; $i+=5) // Can't go higher than n!!!
	{
		$en = Compute($i, 1031, 16717);
		$de = Compute($en, 1847, 16717);

//		$en = Compute($i+$random[$count], 1031, 16717);
//		$de = Compute($en, 1847, 16717) - $random[$count];

		$count = ($count+1) % 1024;

		if ($i == $de)
			echo $i . " " . $en . " " . $de . "<br />";
		else
			echo $i . " " . $en . " " . $de . "  FAIL<br />";
	}
*/


	$encryptme = "AAAABBBB This is a test string.  Can you read me now???";

	echo "<h2>Pre-Encryption</h2>" . $encryptme . "<br />";

//	$encryptme = "AAAA";
	$imback = "";

//	print_r(str_split($encryptme));

	echo "The string has " . strlen($encryptme) . " characters<br />";

	echo "<h2>Encrypted</h2>";
	echo "<div style='word-wrap: break-word'>";

	for ($i=0; $i<strlen($encryptme); $i++) {
		$ch = $encryptme{$i};

		$en = Compute(ord($ch)+$random[$count], 1031, 16717);
		$de = Compute($en, 1847, 16717) - $random[$count];

		$count = ($count+1) % 1024;

		echo dechex($en);

		$imback .= chr($de);
	}

	echo "</div>";
	echo "<h2>Decrypted</h2>" . $imback;


// n=16717	d=1847	e=1031
//    echo Compute(2790, 2753, 3233) . " "; // 65
//    echo Compute(4, 13, 497) . " "; // 445
//    echo Compute(65, 17, 3233) . " "; // 2790

?>


	</div>

</body>
</html>